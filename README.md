# Чечуров Владимир Сергеевич, БПИ227, ОС ИДЗ-2, Вариант 21

Решение выполнялось по критериям на оценку 8.

## Условие

Задача о нелюдимых садовниках. Имеется пустой участок земли (двумерный массив размером M ×N) и план сада, разбитого на отдельные квадраты. От 10 до 30 процентов (задается случайно) площади сада заняты прудами или камнями. То есть недоступны для ухаживания. Эти квадраты располагаются на плане произвольным (случайным) образом. Ухаживание за садом выполняют два садовника, которые не хотят встречаться друг другом (то есть, одновременно появляться в одном и том же квадрате). Первый садовник начинает работу с верхнего левого угла сада и перемещается слева направо, сделав ряд, он спускается вниз и идет в обратном направлении, пропуская обработанные участки. Второй садовник начинает работу с нижнего правого угла сада и перемещается снизу вверх, сделав ряд, он перемещается влево и также идет в обратную сторону. Если садовник видит, что участок сада уже обработан другим садовником или является необрабатываемым, он идет дальше. Если по пути какой-то участок занят другим садовником, то садовник ожидает когда участок освободится, чтобы пройти дальше на доступный ему необработанный участок. Садовники должны работать одновременно со скоростями, определяемыми как параметры задачи. Прохождение через любой квадрат занимает некоторое время, которое задается константой, меньшей чем времена обработки и принимается за единицу времени. Создать многопроцессное приложение, моделирующее работу садовников. Каждый садовник — это отдельный процесс.

## Решение

Сад - двумерный массив, где каждый участок - зона в 2 на 2 клетки. Все садовники - процессы. Каждому участку соответствует свой семафор, который меняет свое значение, когда в него заходит садовник.

При обработке поле, садовник записывает в ячейку массива свой номер.

Двумерный массив на момент создания, а потом и в процессе выполнения заполняется числами:

- 0 — если не обработано 
- -1 — поле не может быть обработано и выводится как Х
- 1 — поле обработано первым садовником
- 2 — поле обработано вторым садовником

### prog4_5.c

Данная программа реализует решение на оценку 4-5, был выбран критерий:

```
Множество процессов взаимодействуют с использованием именованных POSIX семафоров. Обмен данными ведется через разделяемую память в стандарте POSIX.
```

Описание работы:

Родительский процесс создает разделяемую память и семафоры, запускает 2 дочерних процесса-садовника. Когда садовники заканчивают свою работу, родительский процесс освобождает ресурсы. При отправке сигнала о прерывании с клавиатуры сначала завершается исполнение дочерних потоков засчет отправки сигналов, а затем освобождаются ресурсы.

Непригодные для обработки поля занимают случайно 10-30%.

Результат работы при запуске программы с параметрами `2 2 1`:

```
Open shared memory
0 0 0 0 
0 X 0 0 
0 0 0 0 
0 X 0 0 
Gardener 1 open shared memory with field
Gardener 1 on row: 0, column: 0
Gardener 2 open shared memory with field
Gardener 2 on row: 3, column: 3
Gardener 2 on row: 2, column: 3
Gardener 1 on row: 0, column: 1
Gardener 2 on row: 1, column: 3
Gardener 2 on row: 0, column: 3
Gardener 2 on row: 0, column: 2
Gardener 2 on row: 1, column: 2
Gardener 2 on row: 2, column: 2
Gardener 1 on row: 0, column: 2
Gardener 2 on row: 3, column: 2
Gardener 1 on row: 0, column: 3
Gardener 1 on row: 1, column: 3
Gardener 2 on row: 3, column: 1
Gardener 2 on row: 2, column: 1
Gardener 1 on row: 1, column: 2
Gardener 2 on row: 1, column: 1
Gardener 2 on row: 0, column: 1
Gardener 2 on row: 0, column: 0
Gardener 2 on row: 1, column: 0
Gardener 2 on row: 2, column: 0
Gardener 1 on row: 1, column: 1
Gardener 2 on row: 3, column: 0
Gardener 1 on row: 1, column: 0
Gardener 2 finished working...
Gardener 1 on row: 2, column: 0
Gardener 1 on row: 2, column: 1
Gardener 1 on row: 2, column: 2
Gardener 1 on row: 2, column: 3
Gardener 1 on row: 3, column: 3
Gardener 1 on row: 3, column: 2
Gardener 1 on row: 3, column: 1
Gardener 1 on row: 3, column: 0
Gardener 1 finished working...
1 1 2 2 
2 X 2 2 
2 2 2 2 
2 X 2 2
```

### prog6_7.c

Данная программа реализует решение на оценку 6-7, был выбран критерий:

```
Множество процессов взаимодействуют с использованием неименованных POSIX семафоров расположенных в разделяемой памяти. Обмен данными также ведется через разделяемую память в стандарте POSIX
```

Описание работы:

Родительский процесс создает разделяемую память и семафоры, запускает 2 дочерних процесса-садовника. Когда садовники заканчивают свою работу, родительский процесс освобождает ресурсы. При отправке сигнала о прерывании с клавиатуры сначала завершается исполнение дочерних потоков засчет отправки сигналов, а затем освобождаются ресурсы.

Непригодные для обработки поля занимают случайно 10-30%.

Результат работы при запуске программы с параметрами `2 2 1`:

```
Open shared Memory for field
Open shared Memory for semaphores
0 0 0 X 
0 0 0 0 
0 0 0 0 
0 X 0 X 
Gardener 1 open shared memory with semaphores
Gardener 1 open shared memory with field
Gardener 1 on row: 0, column: 0
Gardener 2 open shared memory with semaphores
Gardener 2 open shared memory with field
Gardener 2 on row: 3, column: 3
Gardener 2 on row: 2, column: 3
Gardener 2 on row: 1, column: 3
Gardener 1 on row: 0, column: 1
Gardener 2 on row: 0, column: 3
Gardener 2 on row: 0, column: 2
Gardener 2 on row: 1, column: 2
Gardener 2 on row: 2, column: 2
Gardener 1 on row: 0, column: 2
Gardener 2 on row: 3, column: 2
Gardener 1 on row: 0, column: 3
Gardener 2 on row: 3, column: 1
Gardener 1 on row: 1, column: 3
Gardener 2 on row: 2, column: 1
Gardener 1 on row: 1, column: 2
Gardener 2 on row: 1, column: 1
Gardener 2 on row: 0, column: 1
Gardener 2 on row: 0, column: 0
Gardener 2 on row: 1, column: 0
Gardener 2 on row: 2, column: 0
Gardener 1 on row: 1, column: 1
Gardener 2 on row: 3, column: 0
Gardener 1 on row: 1, column: 0
Gardener 1 on row: 2, column: 0
Gardener 2 finish work
Gardener 1 on row: 2, column: 1
Gardener 1 on row: 2, column: 2
Gardener 1 on row: 2, column: 3
Gardener 1 on row: 3, column: 3
Gardener 1 on row: 3, column: 2
Gardener 1 on row: 3, column: 1
Gardener 1 on row: 3, column: 0
Gardener 1 finish work
1 1 2 X 
2 2 2 2 
2 2 2 2 
2 X 2 X

```

### prog_8

Состоит из трех файлов `first.c` - для процесса первого садовника,`second.c` - для запуска второго садовника, `map_controller.c` - процесс, который контролирует состояние сада.

Желательно сначала запустить садовников, а потом `map_controller.c`

Принцип работы:

Запускаются два садовника и карта, которые представлены в виде трех процессов. Создается семафор, который блокирует работу садовников, он разблокируется картой при создании разделяемой памяти и семафоров для сада. После этого садовники начинают работать. После прохождения всего сада они увеличивают значение семафора, который ответственен за то, чтобы смотреть, закончили ли работу оба садовника. Как только его значение достигает двух (оба садовника прошли по всему полю), генератор карты удаляет все семафоры и разделяемую память, а затем заканчивает свою работу. Удалением общих ресурсов также занимается карта.

Для завершения работы по прерыванию с клавиатуры, процессы хранят в разделяемой память свои ID

Результат работы при запуске программы с параметрами `2 2 1`:

![image-20240421151530398](/home/vlad/.config/Typora/typora-user-images/image-20240421151530398.png)
